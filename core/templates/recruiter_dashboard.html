{% extends "base.html" %}
{% block content %}

<h3 class="mb-3">Recruiter Dashboard – Candidate Applications</h3>
<p class="text-slate-300 small mb-4">
  View submitted applications, their resume match scores, skill gaps, and take
  a decision (Shortlist or Reject).
</p>

<div class="glass p-3">
  <table class="table table-dark table-striped align-middle mb-0">
    <thead>
      <tr>
        <th>Job Title</th>
        <th>Applicant</th>
        <th>Score (%)</th>
        <th>Recommended Skills</th>
        <th>Resume File</th>
        <th>Status</th>
        <th>Decision</th>
      </tr>
    </thead>
    <tbody>
      {% for s in scores %}
        <tr>
          <td>{{ s.job.title }}</td>

          <td>
            {% if s.resume.user and s.resume.user.applicant %}
              {{ s.resume.user.applicant.full_name }}<br>
              <span class="small text-slate-400">
                {{ s.resume.user.email }}
              </span>
            {% elif s.resume.user %}
              {{ s.resume.user.username }}
            {% else %}
              Anonymous
            {% endif %}
          </td>

          <td>
            <span class="badge bg-info text-dark fw-semibold">
              {{ s.value }}%
            </span>
          </td>

          <td class="small">
            {{ s.recommended_skills|default:"–" }}
          </td>

          <td>
            {% if s.resume.file %}
              <a href="{{ s.resume.file.url }}" target="_blank" class="btn btn-sm btn-outline-light">
                View Resume
              </a>
            {% else %}
              <span class="small text-slate-400">No file</span>
            {% endif %}
          </td>

          <td>
            {% if s.status == "SUBMITTED" %}
              <span class="badge bg-warning text-dark">Submitted</span>
            {% elif s.status == "SHORTLISTED" %}
              <span class="badge bg-success">Shortlisted</span>
            {% elif s.status == "REJECTED" %}
              <span class="badge bg-danger">Rejected</span>
            {% else %}
              <span class="badge bg-secondary">{{ s.status }}</span>
            {% endif %}
          </td>

          <td>
            <div class="d-flex gap-2">
              <form method="post" action="{% url 'toggle_shortlist' s.id %}">
                {% csrf_token %}
                <input type="hidden" name="action" value="shortlist">
                <button type="submit"
                        class="btn btn-sm {% if s.status == 'SHORTLISTED' %}btn-success{% else %}btn-outline-success{% endif %}">
                  Shortlist
                </button>
              </form>

              <form method="post" action="{% url 'toggle_shortlist' s.id %}">
                {% csrf_token %}
                <input type="hidden" name="action" value="reject">
                <button type="submit"
                        class="btn btn-sm {% if s.status == 'REJECTED' %}btn-danger{% else %}btn-outline-danger{% endif %}">
                  Reject
                </button>
              </form>
            </div>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="7" class="text-center text-slate-400">
            No submitted applications yet.
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}
